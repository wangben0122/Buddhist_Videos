/* * Copyright (c) 2015, 张涛. * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * *      http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package com.arkui.fz_tools.ui;import android.app.Activity;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.support.v4.app.Fragment;import android.util.Log;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import com.arkui.fz_tools.utils.LogUtil;import io.reactivex.disposables.CompositeDisposable;/** * 兼容v4包的Fragment * * @author kymjs (http://www.kymjs.com/) . *         <p> *         这是一个懒惰的Fragment 用来出来ViewPage 结合Fragment复用的问题 */public abstract class BaseLazyFragment extends Fragment {    //当前Fragment视图对象    protected View fragmentRootView;    //上下文    protected Context mContext;    //Fragment的View加载完毕的标记    private boolean isViewCreated;    //Fragment对用户可见的标记    private boolean isUIVisible;    /**     * Activity对象，避免getActivity()出现null     */    protected Activity mActivity;    public CompositeDisposable mDisposables = new CompositeDisposable();    @Override    public void onAttach(Context context) {        super.onAttach(context);        this.mActivity = (Activity) context;    }    protected abstract View inflaterView(LayoutInflater inflater,                                         ViewGroup container, Bundle bundle);    /**     * initialization widget, you should look like parentView.findviewbyid(id);     * call method     *     * @param parentView     */    protected void initView(View parentView) {    }    /**     * initialization data     */    protected void initData() {    }    /**     * 当通过changeFragment()显示时会被调用(类似于onResume)     */    public void onChange() {    }    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        Log.e("lzb", "onCreateView");        mContext = getActivity();        //改造下这里避免重复加载        if (fragmentRootView == null) {            fragmentRootView = inflaterView(inflater, container, savedInstanceState);            isViewCreated = true;            initView(fragmentRootView);            initData();        }        lazyLoad();        return fragmentRootView;    }    public void showActivity(Class<?> cls) {        Intent intent = new Intent();        intent.setClass(mContext, cls);        startActivity(intent);    }    public void showActivity(Intent it) {        startActivity(it);    }    public void showActivity(Class<?> cls, Bundle extras) {        Intent intent = new Intent();        intent.putExtras(extras);        intent.setClass(mContext, cls);        startActivity(intent);    }    @Override    public void onDestroy() {        super.onDestroy();        mDisposables.clear();    }    /**     * 判断当前Fragment是否已经显示     *     * @param isVisibleToUser     */    @Override    public void setUserVisibleHint(boolean isVisibleToUser) {        super.setUserVisibleHint(isVisibleToUser);        if (isVisibleToUser) {            isUIVisible = true;            lazyLoad();        } else {            isUIVisible = false;        }    }    private void lazyLoad() {        //这里进行双重标记判断,是因为setUserVisibleHint会多次回调,并且会在onCreateView执行前回调,必须确保onCreateView加载完毕且页面可见,才加载数据        if (isViewCreated && isUIVisible) {            lazyLoadData();            //数据加载完毕,恢复标记,防止重复加载            isViewCreated = false;            isUIVisible = false;        }    }    /**     * 需要进行懒加载的数据     */    protected abstract void lazyLoadData();}